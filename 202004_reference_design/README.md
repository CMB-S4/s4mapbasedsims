Design simulation tool: reference design
========================================

Release:

* Noise + Atmosphere: 28 April 2020, `s4_design_sim_tool` 1.0.2
* CMB `r=0`: 14 May 2020, `s4_design_sim_tool` 1.0.3


This is a set of maps generated by the CMB-S4 design simulation tool, available at <https://github.com/CMB-S4/s4_design_sim_tool>

It is a map-based tool which combines and weights pre-generated maps generated via small time domain simulations and weights them based on the CMB-S4 design (e.g. number of tubes per telescope per site).

This first simulation uses the Reference Design setup, the input configuration file for the design simulation tool is quite
self explanatory, see:

* [`s4_reference_design_nosky_7splits.toml`](s4_reference_design_nosky_7splits.toml) in this repository for the noise simulations
* [`s4_reference_design_cmb_r0.toml`](s4_reference_design_cmb_r0.toml) in this repository for the CMB with no tensor modes


Documentation about the input maps and the transfer function applied by the tool is available
in the documentation of the design simulation tool available at: <https://cmb-s4.github.io/s4_design_sim_tool/>.

# Available maps

* `N_side` 512 for SAT, 4096 for LAT
* float32 precision
* `K_CMB` unit
* One map per band per site which combines all the telescopes at that band, atmosphere scales down as telescope-years, noise as detector-years

Metadata are available in the fits headers of extension 1, for example:

```
SOFTWARE= 's4_design_sim_tool'                                                  
SW_VERS = '1.0.1   '                                                            
SKY_VERS= '1.0     '                                                            
ATM_VERS= '1.0     '                                                            
NOI_VERS= '1.0     '                                                            
SITE    = 'Pole    '                                                            
SPLIT   =                    2                                                  
NSPLITS =                    7                                                  
CHANNEL = 'HFL1    '                                                            
DATE    = '2020-04-23'                                                          
CONFMD5 = '79858f71dbaf1c8bd9bd57a2cbea57ed'   
```

## Noise and atmosphere

1 full map based on 7 years of mission and 7 independent splits with equal sky coverage.

Maps are available at NERSC at:

    /global/cscratch1/sd/zonca/cmbs4/s4refsimtool/reference_design_nosky_7splits

Will be moved to project space later on and the path here updated

File naming convention:

    "{telescope}-{band}_{site}/cmbs4_{tag}_KCMB_{telescope}-{band}_{site}_nside{nside}_{split}_of_{nsplits}.fits"

Where:
   
* `telescope` LAT or SAT
* `band` e.g. LFL2
* `site` pole or chile
* `split` and `nsplits` the current split and the number of splits, so `1_of_1` is a full mission map, `3 of 7` is the 3rd year of observation on 7 yearly splits.

For example:

    LAT-LFL2_chile/cmbs4_atmosphere_noise_KCMB_LAT-LFL2_chile_nside4096_1_of_1.fits
    LAT-LFL2_chile/cmbs4_atmosphere_noise_KCMB_LAT-LFL2_chile_nside4096_3_of_7.fits

## CMB no tensor modes

1 full map which includes CMB emission with `r=0` and lensing using the potential from Websky and has gone through filter-and-bin mapmaking.

See <https://github.com/CMB-S4/s4mapbasedsims/tree/master/202002_foregrounds_extragalactic_cmb_tophat#input-components> for more information about the inputs.

Maps are available at NERSC at:

    /global/cscratch1/sd/zonca/cmbs4/s4refsimtool/reference_design_cmb_r0

Will be moved to project space later on and the path here updated

File naming convention:

    "{telescope}-{band}_{site}/cmbs4_KCMB_{telescope}-{band}_{site}_nside{nside}_{split}_of_{nsplits}.fits"

Where:
   
* `telescope` LAT or SAT
* `band` e.g. LFL2
* `site` pole or chile
* `split` and `nsplits` the current split and the number of splits, so `1_of_1` is a full mission map

For example:

    LAT-LFL2_chile/cmbs4_KCMB_LAT-LFL2_chile_nside4096_1_of_1.fits
